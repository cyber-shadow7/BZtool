<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      property="og:image"
      content="https://cdn.discordapp.com/attachments/1189441508538073168/1198763038870872064/image.png?ex=65c01614&is=65ada114&hm=7fd5fd46b4a1be939bd858b4183f3f725ca1a8654b7082c7fe8f7981e7544e44&"
    />

    <title>Net Worth Chart</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #222;
        color: white;
      }

      .container {
        text-align: center;
        width: 100%;
      }

      .chart-container {
        margin: 20px auto;
        width: 80%;
        max-width: 800px;
        height: 80vh;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Net Worth Chart</h1>
      <h2>Next starts on 2/1/24</h2>
      <div class="chart-container">
        <canvas id="netWorthChart"></canvas>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const ctx = document.getElementById("netWorthChart").getContext("2d");

        const netWorthData = {
          apollo800813: [509920064, null, null, 531961117, null, 640729637],
          thecooliguy791: [886162, null, null, 879469, null, 962816],
          Im_Yuno: [6075731397, null, null, 6318901653, null, 6952519504],
          Im_Gwimace: [517254706, null, null, 513119669, null, 351041590],
          aura7: [3877464773, null, null, 3963714854, null, 3818766224],
          Ramy08: [410311726, null, null, 405829467, null, 413555114],
          Sidosaurus_Rex: [554740845, null, null, 634394899, null, 650324705],
          DDraco_Toast: [606586216, null, null, 557427620, null, 507107758],
          difficultentrpot: [
            2826283299,
            null,
            null,
            2882160744,
            null,
            2757508598,
          ],
          FARPlNHA: [295872256, null, null, 298654944, null, 302147073],
          KashieAz8: [4507978271, null, null, 4257311681, null, 4272373890],
          scteras: [2402996220, null, null, 2674296971, null, 2704081040],
          PepsiNotSexy: [240046655, null, null, 242658184, null, 178405128],
          MagiclessHippo: [
            5825001833,
            null,
            null,
            6000913112,
            null,
            5962895544,
          ],
          Tuski000: [225156344, null, null, 232737503, null, 236564969],
          echofighter310: ["!", "!", 816629842, 1007095342, null, 1069348938],
        };

        // Interpolate data points for all users
        for (const user in netWorthData) {
          console.log(`Before interpolation for ${user}:`, netWorthData[user]);

          // Convert string numbers to actual numbers
          netWorthData[user] = netWorthData[user].map((value) =>
            typeof value === "string" ? parseFloat(value) : value
          );

          interpolateNullValues(netWorthData[user]);
          console.log(`After interpolation for ${user}:`, netWorthData[user]);
        }

        const labels = Object.keys(netWorthData);
        const dataPoints = Object.values(netWorthData);
        const numDataPoints = dataPoints[0].length;

        const sortedNames = labels.sort((a, b) => {
          const differencesA = calculateDifferences(netWorthData[a]);
          const differencesB = calculateDifferences(netWorthData[b]);
          const lastValueA = differencesA[differencesA.length - 1];
          const lastValueB = differencesB[differencesB.length - 1];
          return lastValueB - lastValueA;
        });

        const datasets = sortedNames.map((name) => {
          const differences = calculateDifferences(netWorthData[name]);

          const latestDiff = differences[numDataPoints - 1];
          const formattedLatestDiff = latestDiff.toLocaleString("en-US");

          return {
            label: `${name} (${
              latestDiff >= 0 ? "+" : ""
            }${formattedLatestDiff})`,
            data: differences,
            fill: false,
            borderColor: getRandomColor(),
            tension: 0.1,
          };
        });

        const customLabels = [
          "2/1",
          "2/2",
          "2/3",
          "2/4",
          "2/5",
          "2/6",
          "2/7",
          "2/8",
          "2/9",
          "2/10",
          "2/11",
          "2/12",
          "2/13",
          "2/14",
          "2/15",
          "2/16",
          "2/17",
          "2/18",
          "2/19",
          "2/20",
          "2/21",
          "2/22",
          "2/23",
          "2/24",
          "2/25",
          "2/26",
          "2/27",
          "2/28",
          "2/29",
        ];
        // Replace with your custom labels

        new Chart(ctx, {
          type: "line",
          data: {
            labels: customLabels,
            datasets: datasets,
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  color: "white",
                },
              },
              x: {
                ticks: {
                  color: "white",
                },
              },
            },
            plugins: {
              legend: {
                position: "right",
                align: "start",
                labels: {
                  color: "white",
                  usePointStyle: true,
                },
              },
              zoom: {
                pan: {
                  enabled: true,
                  mode: "xy",
                },
                zoom: {
                  wheel: {
                    enabled: true,
                  },
                  pinch: {
                    enabled: true,
                  },
                  mode: "xy",
                },
              },
            },
          },
        });

        function getRandomColor() {
          const letters = "0123456789ABCDEF";
          let color = "#";
          for (let i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
          }
          return color;
        }

        function calculateDifferences(data) {
          const differences = [];
          const initialValue = data[Object.keys(data)[0]];
          for (const key in data) {
            differences.push(data[key] - initialValue);
          }
          return differences;
        }

        // Function to interpolate data points marked with null
        function interpolateNullValues(data) {
          for (let i = 0; i < data.length; i++) {
            if (data[i] === null) {
              let startIndex = i - 1;
              let endIndex = i + 1;

              // Find the nearest valid data points
              while (data[startIndex] === null) {
                startIndex--;
              }
              while (data[endIndex] === null) {
                endIndex++;
              }

              // Linear interpolation formula
              const interpolatedValue =
                data[startIndex] +
                ((i - startIndex) / (endIndex - startIndex)) *
                  (data[endIndex] - data[startIndex]);

              // Replace the null with the interpolated value
              data[i] = interpolatedValue;
            }
          }
        }
      });
    </script>
  </body>
</html>
